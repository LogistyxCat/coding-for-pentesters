#!/bin/bash

 #########################################
 #Name: Riley Scott                      #
 #Date: 2017-11-1                        #
 #Version 1.6                            #
 #Description: TCP port scanner in BASH  #
 #########################################

 #Populate variables from arguments
host=$1
type=$2
startport=$3
stopport=$4

 #ping a device to see if it is up
function pingcheck
{
  ping=`ping -c 1 $host | grep bytes | wc -l`
  if [ "$ping" -gt 1 ]; then
    echo "$host is up";
  else
    echo "$host is down, quitting"
    exit
  fi
}

 #test a port to see if tcp port is open
function tcpcheck
{
  for ((counter=$startport; counter<=$stopport; counter++))
  do
    (echo >/dev/tcp/$host/$counter) > /dev/null 2>&1 && echo "TCP $counter open"
  done
}

 #test a port to see if tcp port is open
function udpcheck
{
 for ((counter=$startport; counter<=$stopport; counter++))
 do
   (echo >/dev/udp/$host/$counter) > /dev/null 2>&1 && echo "UDP $counter open"
 done
}

 #running functions
pingcheck

{
if [ "$type" = "both" ]; then
  echo "Scanning TCP ports"
  tcpcheck
  echo "Scanning UDP ports"
  udpcheck
elif [ "$type" = "tcp" ]; then
  tcpcheck
elif [ "$type" = "udp" ]; then
  udpcheck
else
  echo "Invalid use. Command is structured as 'portscan [ tcp | udp | both ] startport# endport#''"
  exit
fi
}
